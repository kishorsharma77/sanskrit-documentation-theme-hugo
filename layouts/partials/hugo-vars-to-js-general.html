<script type="text/javascript">
    let baseURL = "{{.Site.BaseURL}}";
    let basePath = "/" + baseURL.split("/").slice(3).join("/");
    let siteParams = JSON.parse("{{.Site.Params | jsonify}}");
    let pageDefaultsList = JSON.parse({{.Site.Data.page_defaults | jsonify}});
    let sidebarsData = JSON.parse("{{$.Site.Data.sidebars | jsonify}}");
    let autocompletePageUrl = "{{ "data/pages.tsv" | relURL }}";

    var pageUrlToTitle = {};
    // Note that only pages parsed and generated by jekyll are processed below - not ready files like pdf-s and htmls.
    // PS: {{.URL}} includes the subpath bit of the baseUrl, hence we subtract it from absUrl. 
    {{ range $.Site.Pages  }}{{ if isset .Params "title"  }}
    {{ $absUrl := .URL | absURL }}{{ $urlMinusBase := replace $absUrl .Site.BaseURL "/" }}
    pageUrlToTitle["{{$urlMinusBase}}"] = "{{.Params.title}}";
    {{ end }}{{ end }}

    // For directory listing:
    var pageDirectoryToUrl = {};
    // Can this be reliably filled using pageUrlToTitle? No - one cannot distinguish x/y/z/_index.md files as belonging to x/y/z/ since they get the url x/y/z/ just like any other page x/y/w/. 

    function addToPageDirectoryToUrlMap(dirPath, pageUrlTmp) {
        if (pageDirectoryToUrl.hasOwnProperty(dirPath)) {
            pageDirectoryToUrl[dirPath].push(pageUrlTmp);
        } else {
            pageDirectoryToUrl[dirPath] = [pageUrlTmp];
        }
    }
    // Note that only pages parsed and generated by jekyll are processed below - not ready files like pdf-s and htmls.
    // PS: {{.URL}} includes the subpath bit of the baseUrl, hence we subtract it from absUrl. 
    {{ range $.Site.Pages  }} {{ $absUrl := .URL | absURL }}{{ $urlMinusBase := replace $absUrl .Site.BaseURL "/" }}
    addToPageDirectoryToUrlMap("/{{ (path.Split .Path).Dir }}".toLowerCase(), "{{$urlMinusBase}}");
    {{ end }}

</script>
