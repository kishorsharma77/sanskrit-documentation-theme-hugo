<script type="text/javascript">
    // Note that this file should not contain definitions for page-specific variables. Reason: Hugo builds this partial just once and includes it everywhere.
    let baseURL = "{{.Site.BaseURL}}";
    let basePath = "/" + baseURL.split("/").slice(3).join("/");
    let siteParams = JSON.parse("{{.Site.Params | jsonify}}");
    let pageDefaultsList = JSON.parse("{{.Site.Data.page_defaults | jsonify}}");
    let sidebarsData = JSON.parse("{{$.Site.Data.sidebars | jsonify}}");
    let autocompletePageUrl = "{{ "data/pages.tsv" | relURL }}";

    var pageUrlToParams = new Map();
    // Note that only pages parsed and generated by jekyll are processed below - not ready files like pdf-s and htmls.
    // PS: .RelPermalink includes the subpath bit of the baseUrl, hence we subtract it from absUrl. 
    {{ range $.Site.Pages  }}
    {{ $absUrl := .RelPermalink | absURL }}{{ $urlMinusBase := replace $absUrl .Site.BaseURL "/" }}
    pageUrlToParams.set("{{$urlMinusBase}}", JSON.parse("{{.Params | jsonify}}"));
    {{ end }}

    var pageUrlToFileParams = new Map();
    // Note that only pages parsed and generated by jekyll are processed below - not ready files like pdf-s and htmls.
    // PS: .RelPermalink includes the subpath bit of the baseUrl, hence we subtract it from absUrl. 
    {{ range $.Site.Pages  }}
    {{ $absUrl := .RelPermalink | absURL }}{{ $urlMinusBase := replace $absUrl .Site.BaseURL "/" }}
    {{ with .File }}
    pageUrlToFileParams.set("{{$urlMinusBase}}", JSON.parse(`{
      "path": "{{.Path}}",
      "logicalName": "{{.LogicalName}}",
      "baseFileName": "{{.BaseFileName}}",
      "dir": "{{.Dir}}"
    }`));
    {{ end }}
    {{ end }}

    // For directory listing:
    var pageRelUrlTree = {};
    // TODO: Can this be reliably filled using pageUrlToTitle? 

    function addRelUrlToTree(item, absUrl) {
        var parts = item.split("/").filter(x => x.length > 0);
        // Navigate with the prefix into the tree. 
        var cursor = pageRelUrlTree;
        parts.forEach(function(part){
            if(!cursor[part]) cursor[part] = {"absUrl": absUrl};
            cursor = cursor[part];
        });
    }

    // Note that only pages parsed and generated by jekyll are processed below - not ready files like pdf-s and htmls.
    // PS: .RelPermalink includes the subpath bit of the baseUrl, hence we subtract it from absUrl. 
    {{ range $.Site.Pages  }} {{ $absUrl := .RelPermalink | absURL }}{{ $urlMinusBase := replace $absUrl .Site.BaseURL "/" }}
    addRelUrlToTree("{{$urlMinusBase}}", "{{ $absUrl }}");
    {{ end }}

</script>
